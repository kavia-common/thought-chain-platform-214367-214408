{"is_source_file": true, "format": "Python", "description": "This is a FastAPI-based backend source file for a 'Daily Thought Chain' application. It defines API endpoints for health checks, listing thoughts, and creating new thoughts, with database interactions via SQLite. The code includes data models, database schema setup, and logic to enforce one thought submission per user per UTC day.", "external_files": ["thought_database/db_connection.txt"], "external_methods": ["os.path.abspath", "os.path.exists", "open", "re.search", "os.path.isabs", "sqlite3.connect", "datetime.fromisoformat", "datetime.replace", "datetime.isoformat"], "published": ["app"], "classes": [{"name": "ThoughtIn", "description": "Pydantic model for incoming thought submissions, ensuring username and thought_text are valid and trimmed."}, {"name": "ThoughtOut", "description": "Pydantic model for returning stored thoughts with metadata, including ID, username, thought text, and creation timestamp."}], "methods": [{"name": "str _read_sqlite_path_from_db_container()", "description": "Reads the SQLite database file path from a specific config file, parsing for an absolute path.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection _get_db_connection()", "description": "Establishes a SQLite connection with proper row factory.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_schema(conn: sqlite3.Connection)", "description": "Creates the 'thoughts' table if it does not exist.", "scope": "", "scopeKind": ""}, {"name": "ThoughtOut _row_to_thought_out(row: sqlite3.Row)", "description": "Converts a SQLite row to a ThoughtOut model with ISO-formatted timestamp.", "scope": "", "scopeKind": ""}, {"name": "health_check()", "description": "Endpoint to check if the service is healthy.", "scope": "", "scopeKind": ""}, {"name": "List[ThoughtOut] list_thoughts()", "description": "Fetches and returns all thoughts ordered chronologically.", "scope": "", "scopeKind": ""}, {"name": "ThoughtOut create_thought(payload: ThoughtIn)", "description": "Creates a new thought for a user, ensuring only one per user per UTC day, and returns the created record.", "scope": "", "scopeKind": ""}, {"name": "str validate_thought_text(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str validate_username(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}], "calls": ["os.path.abspath", "os.path.exists", "open", "re.search", "sqlite3.connect", "datetime.fromisoformat", "datetime.replace", "datetime.isoformat"], "search-terms": ["Daily Thought Chain API", "thoughts endpoint", "SQLite schema", "FastAPI health check", "one thought per user per UTC day"], "state": 2, "file_id": 4, "knowledge_revision": 10, "git_revision": "a481ab20a26b099ca185a0effd79b18ea5f21218", "revision_history": [{"9": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"10": "a481ab20a26b099ca185a0effd79b18ea5f21218"}], "ctags": [{"_type": "tag", "name": "ThoughtIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtOut", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ensure_schema", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _ensure_schema(conn: sqlite3.Connection) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_get_db_connection", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _get_db_connection() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_read_sqlite_path_from_db_container", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _read_sqlite_path_from_db_container() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_row_to_thought_out", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _row_to_thought_out(row: sqlite3.Row) -> ThoughtOut:$/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "(row: sqlite3.Row)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def create_thought(payload: ThoughtIn) -> ThoughtOut:$/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "(payload: ThoughtIn)"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    created_at: str = Field(..., description=\"Creation timestamp in ISO 8601 UTC.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    id: int = Field(..., description=\"Unique identifier of the thought.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "list_thoughts", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def list_thoughts() -> List[ThoughtOut]:$/", "language": "Python", "typeref": "typename:List[ThoughtOut]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The textual content of the user's thought.\", min/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"Thought text.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"The username of the person submitting the thought.\",/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"Username of the author.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_username(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}], "hash": "fd401a841e48466d4c9c03963e224261", "format-version": 4, "code-base-name": "thought_backend", "filename": "thought_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str created_at", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "int id", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str thought_text", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}]}