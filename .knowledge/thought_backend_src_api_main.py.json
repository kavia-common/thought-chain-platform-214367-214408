{"is_source_file": true, "format": "Python (FastAPI)", "description": "This file is the main source code for a REST API backend service that handles user-submitted thoughts. It includes endpoints for health checks, listing thoughts, creating new thoughts (with restrictions on one per user per day), updating thoughts with edit tokens, deleting thoughts, and a development-only endpoint to clear all thoughts. It uses FastAPI with Pydantic models for request validation, and interacts with a SQLite database to store thoughts and enforce uniqueness constraints. The file also manages schema creation and database connection logic.", "external_files": ["thought_chain-platform-214367-214408/thought_database/db_connection.txt"], "external_methods": ["_read_sqlite_path_from_db_container", "_get_db_connection", "_column_exists", "_index_exists", "_ensure_schema", "_row_to_thought_out", "_day_key_utc_now"], "published": ["health_check", "list_thoughts", "create_thought", "update_thought", "delete_thought", "dev_clear_all_thoughts", "ThoughtIn", "ThoughtOut", "ThoughtCreatedResponse", "ThoughtPatchIn"], "classes": [{"name": "ThoughtIn", "description": "Pydantic model for incoming thought submissions with validation."}, {"name": "ThoughtOut", "description": "Pydantic model for outgoing thought data representation."}, {"name": "ThoughtCreatedResponse", "description": "Extended response model including secret edit_token for created thoughts."}, {"name": "ThoughtPatchIn", "description": "Model for patch/update requests for thoughts, validating the new thought text."}], "methods": [{"name": "ThoughtOut _row_to_thought_out(row: sqlite3.Row)", "description": "Converts a SQLite row to a ThoughtOut model with timestamp normalization.", "scope": "", "scopeKind": ""}, {"name": "str _day_key_utc_now()", "description": "Returns the current UTC date string used for daily thought constraints.", "scope": "", "scopeKind": ""}, {"name": "health_check()", "description": "Health check endpoint returning a simple JSON message.", "scope": "", "scopeKind": ""}, {"name": "List[ThoughtOut] list_thoughts()", "description": "Fetches all stored thoughts ordered chronologically.", "scope": "", "scopeKind": ""}, {"name": "ThoughtCreatedResponse create_thought(payload: ThoughtIn)", "description": "Creates a new thought, enforcing one per user per UTC day with token validation.", "scope": "", "scopeKind": ""}, {"name": "ThoughtOut update_thought( thought_id: int = Path(..., description=\"ID of the thought to update.\"), payload: ThoughtPatchIn = ..., x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )", "description": "Updates a thought if provided with a valid edit token.", "scope": "", "scopeKind": ""}, {"name": "delete_thought( thought_id: int = Path(..., description=\"ID of the thought to delete.\"), x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )", "description": "Deletes a thought if provided with a valid edit token.", "scope": "", "scopeKind": ""}, {"name": "dict dev_clear_all_thoughts()", "description": "Development-only endpoint to clear all thoughts and reset state.", "scope": "", "scopeKind": ""}, {"name": "bool _column_exists(conn: sqlite3.Connection, table: str, column: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "None _ensure_schema(conn: sqlite3.Connection)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "sqlite3.Connection _get_db_connection()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool _index_exists(conn: sqlite3.Connection, index_name: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str _read_sqlite_path_from_db_container()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str validate_thought_text(cls, v: str)", "scope": "ThoughtPatchIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str validate_token(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str validate_username(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}], "calls": ["sqlite3.connect", "conn.execute", "conn.commit", "conn.close", "re.search", "secrets.token_urlsafe", "datetime.utcnow", "datetime.fromisoformat"], "search-terms": ["FastAPI thoughts API", "SQLite thoughts storage", "per-user per-day thought submission", "thought edit token", "admin clear thoughts", "thoughts CRUD", "thoughts schema ensuring", "thoughts token uniqueness"], "state": 2, "file_id": 4, "knowledge_revision": 29, "git_revision": "c9e6f8f975172ea3de8bd789025d535b1d7648c9", "revision_history": [{"9": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"10": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"14": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"15": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"17": "efcba064533a2f6f23e3272356ccc8e0b776efdb"}, {"18": "efcba064533a2f6f23e3272356ccc8e0b776efdb"}, {"24": "3e8e3a1b99667b518458c4e66f2bb07e4a656667"}, {"25": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"26": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"27": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"28": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"29": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}], "ctags": [{"_type": "tag", "name": "ThoughtCreatedResponse", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtCreatedResponse(ThoughtOut):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtOut", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtPatchIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtPatchIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_column_exists", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _column_exists(conn: sqlite3.Connection, table: str, column: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: sqlite3.Connection, table: str, column: str)"}, {"_type": "tag", "name": "_day_key_utc_now", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _day_key_utc_now() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_ensure_schema", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _ensure_schema(conn: sqlite3.Connection) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_get_db_connection", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _get_db_connection() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_index_exists", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _index_exists(conn: sqlite3.Connection, index_name: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: sqlite3.Connection, index_name: str)"}, {"_type": "tag", "name": "_read_sqlite_path_from_db_container", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _read_sqlite_path_from_db_container() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_row_to_thought_out", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _row_to_thought_out(row: sqlite3.Row) -> ThoughtOut:$/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "(row: sqlite3.Row)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def create_thought(payload: ThoughtIn) -> ThoughtCreatedResponse:$/", "language": "Python", "typeref": "typename:ThoughtCreatedResponse", "kind": "function", "signature": "(payload: ThoughtIn)"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    created_at: str = Field(..., description=\"Creation timestamp in ISO 8601 UTC.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "delete_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def delete_thought($/", "language": "Python", "kind": "function", "signature": "( thought_id: int = Path(..., description=\"ID of the thought to delete.\"), x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )"}, {"_type": "tag", "name": "dev_clear_all_thoughts", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def dev_clear_all_thoughts() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "edit_token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    edit_token: str = Field(..., description=\"Secret token required to edit or delete this thoug/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtCreatedResponse", "scopeKind": "class"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    id: int = Field(..., description=\"Unique identifier of the thought.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "list_thoughts", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def list_thoughts() -> List[ThoughtOut]:$/", "language": "Python", "typeref": "typename:List[ThoughtOut]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The new textual content of the thought.\", min_le/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtPatchIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The textual content of the user's thought.\", min/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"Thought text.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    token: str = Field(..., description=\"Anonymous client token to enforce 1 submission per UTC /", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "update_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def update_thought($/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "( thought_id: int = Path(..., description=\"ID of the thought to update.\"), payload: ThoughtPatchIn = ..., x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"The username of the person submitting the thought.\",/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"Username of the author.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtPatchIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_token(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_username(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}], "hash": "50936700d1ad200ce1d8aa1d5fe786aa", "format-version": 4, "code-base-name": "thought_backend", "filename": "thought_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str created_at", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str edit_token", "scope": "ThoughtCreatedResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int id", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str thought_text", "scope": "ThoughtPatchIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str token", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}]}