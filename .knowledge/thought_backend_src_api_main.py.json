{"is_source_file": true, "format": "Python", "description": "This is a FastAPI-based backend source file implementing a thoughts submission and retrieval API with SQLite database integration, including schema management, CRUD operations, and admin maintenance endpoints.", "external_files": ["dotenv", "fastapi", "pydantic", "sqlite3"], "external_methods": ["load_dotenv", "FastAPI", "HTTPException", "status", "Header", "Query", "Path", "Field", "field_validator", "datetime", "timezone", "secrets", "re", "os.path.exists", "os.path.abspath", "os.path.join", "os.path.dirname", "os.getenv", "sqlite3.connect"], "published": ["health_check", "list_thoughts", "create_thought", "update_thought", "delete_thought", "dev_clear_all_thoughts"], "classes": [{"name": "ThoughtIn", "description": "Pydantic model for incoming thought submissions, validating username, thought_text, and token."}, {"name": "ThoughtOut", "description": "Pydantic model for outgoing thought data, including id, username, thought_text, created_at."}, {"name": "ThoughtCreatedResponse", "description": "Extended response model including edit_token for created thoughts."}, {"name": "ThoughtPatchIn", "description": "Pydantic model for updating a thought, validating new thought_text."}], "methods": [{"name": "_row_to_thought_out", "description": "Converts a SQLite row to a ThoughtOut model, normalizing created_at to ISO format."}, {"name": "_day_key_utc_now", "description": "Returns current UTC date as a string in YYYY-MM-DD format."}, {"name": "health_check", "description": "Health check endpoint returning a simple 'Healthy' message."}, {"name": "list_thoughts", "description": "Retrieves all thoughts ordered by creation time ascending."}, {"name": "create_thought", "description": "Creates a new thought, enforcing one per user per UTC day, returning the thought with an edit token."}, {"name": "update_thought", "description": "Updates the text of an existing thought, requiring a valid edit token."}, {"name": "delete_thought", "description": "Deletes a thought by ID, requiring a valid edit token."}, {"name": "dev_clear_all_thoughts", "description": "Development-only endpoint to clear all thoughts and related token guard entries, guarded by environment variable."}], "calls": ["load_dotenv", "FastAPI", "HTTPException", "status", "Header", "Query", "Path", "Field", "field_validator", "datetime.fromisoformat", "datetime.utcnow", "secrets.token_urlsafe", "re.search", "os.path.exists", "os.path.abspath", "os.path.join", "sqlite3.connect", "conn.execute", "conn.fetchall", "conn.commit", "conn.close"], "search-terms": ["FastAPI", "SQLite", "Thoughts API", "Thoughts CRUD", "Thoughts schema", "Thoughts admin", "Thoughts token", "Thoughts per day", "Thoughts in-memory schema", "Thoughts environment variable"], "state": 2, "file_id": 4, "knowledge_revision": 42, "git_revision": "735dbfe880f7722218ab11a2d608e0ad373d478d", "revision_history": [{"9": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"10": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"14": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"15": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"17": "efcba064533a2f6f23e3272356ccc8e0b776efdb"}, {"18": "efcba064533a2f6f23e3272356ccc8e0b776efdb"}, {"24": "3e8e3a1b99667b518458c4e66f2bb07e4a656667"}, {"25": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"26": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"27": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"28": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"29": "c9e6f8f975172ea3de8bd789025d535b1d7648c9"}, {"35": "735dbfe880f7722218ab11a2d608e0ad373d478d"}, {"42": "735dbfe880f7722218ab11a2d608e0ad373d478d"}], "ctags": [], "filename": "thought_backend/src/api/main.py", "format-version": 4, "code-base-name": "https://github.com/kavia-common/thought-chain-platform-214367-214408.git:kavia-main"}