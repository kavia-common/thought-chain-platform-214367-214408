{"is_source_file": true, "format": "Python", "description": "This Python source file defines a FastAPI web application that manages a 'Thought Chain' API. It includes endpoints for health checks, listing thoughts, creating thoughts, updating and deleting thoughts, with data validated via Pydantic models. The thoughts are stored in a SQLite database, with schema management functions included. The file handles database connection setup, schema ensuring, and CRUD operations, required for a service that allows users to submit and fetch daily thoughts, one per user per UTC day.", "external_files": ["sqlite3", "os", "re", "secrets", "datetime", "fastapi", "pydantic"], "external_methods": ["sqlite3.connect", "os.path.exists", "os.path.abspath", "os.path.join", "os.path.dirname", "os.path.isabs", "re.search", "secrets.token_urlsafe", "datetime.fromisoformat"], "published": ["health_check", "list_thoughts", "create_thought", "update_thought", "delete_thought", "ThoughtIn", "ThoughtOut", "ThoughtCreatedResponse", "ThoughtPatchIn"], "classes": [{"name": "ThoughtIn", "description": "Pydantic model for incoming thought submissions, validating username and thought text."}, {"name": "ThoughtOut", "description": "Pydantic model for representing thoughts with id, username, thought_text, and created_at timestamp."}, {"name": "ThoughtCreatedResponse", "description": "Extends ThoughtOut with an additional edit_token field, for responses after creating a thought."}, {"name": "ThoughtPatchIn", "description": "Pydantic model for updating thought text, with validation."}], "methods": [{"name": "str _read_sqlite_path_from_db_container()", "description": "Reads and parses the SQLite DB file path from the 'db_connection.txt' configuration file.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection _get_db_connection()", "description": "Establishes a SQLite database connection using the parsed database file path.", "scope": "", "scopeKind": ""}, {"name": "bool _column_exists(conn: sqlite3.Connection, table: str, column: str)", "description": "Checks if a specific column exists in a given table.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_schema(conn: sqlite3.Connection)", "description": "Creates and updates the thoughts table schema to ensure it has required columns.", "scope": "", "scopeKind": ""}, {"name": "ThoughtOut _row_to_thought_out(row: sqlite3.Row)", "description": "Converts a SQLite row into a ThoughtOut Pydantic model, normalizing timestamp.", "scope": "", "scopeKind": ""}, {"name": "ThoughtCreatedResponse create_thought(payload: ThoughtIn)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "delete_thought( thought_id: int = Path(..., description=\"ID of the thought to delete.\"), x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[ThoughtOut] list_thoughts()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ThoughtOut update_thought( thought_id: int = Path(..., description=\"ID of the thought to update.\"), payload: ThoughtPatchIn = ..., x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str validate_thought_text(cls, v: str)", "scope": "ThoughtPatchIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str validate_username(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}], "calls": ["_read_sqlite_path_from_db_container", "_get_db_connection", "_column_exists", "_ensure_schema", "_row_to_thought_out", "os.path.abspath", "os.path.join", "re.search", "secrets.token_urlsafe", "datetime.fromisoformat", "sqlite3.connect"], "search-terms": ["FastAPI", "Thoughts API", "SQLite schema", "daily thoughts", "one thought per user per day", "edit token", "thoughts endpoints", "thoughts CRUD", "ThoughtIn", "ThoughtOut"], "state": 2, "file_id": 4, "knowledge_revision": 15, "git_revision": "f30b577a0c112a5e2891229bb1713d1cad65d7c2", "revision_history": [{"9": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"10": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"14": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"15": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}], "ctags": [{"_type": "tag", "name": "ThoughtCreatedResponse", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtCreatedResponse(ThoughtOut):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtOut", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtPatchIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtPatchIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_column_exists", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _column_exists(conn: sqlite3.Connection, table: str, column: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: sqlite3.Connection, table: str, column: str)"}, {"_type": "tag", "name": "_ensure_schema", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _ensure_schema(conn: sqlite3.Connection) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_get_db_connection", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _get_db_connection() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_read_sqlite_path_from_db_container", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _read_sqlite_path_from_db_container() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_row_to_thought_out", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _row_to_thought_out(row: sqlite3.Row) -> ThoughtOut:$/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "(row: sqlite3.Row)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def create_thought(payload: ThoughtIn) -> ThoughtCreatedResponse:$/", "language": "Python", "typeref": "typename:ThoughtCreatedResponse", "kind": "function", "signature": "(payload: ThoughtIn)"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    created_at: str = Field(..., description=\"Creation timestamp in ISO 8601 UTC.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "delete_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def delete_thought($/", "language": "Python", "kind": "function", "signature": "( thought_id: int = Path(..., description=\"ID of the thought to delete.\"), x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )"}, {"_type": "tag", "name": "edit_token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    edit_token: str = Field(..., description=\"Secret token required to edit or delete this thoug/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtCreatedResponse", "scopeKind": "class"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    id: int = Field(..., description=\"Unique identifier of the thought.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "list_thoughts", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def list_thoughts() -> List[ThoughtOut]:$/", "language": "Python", "typeref": "typename:List[ThoughtOut]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The new textual content of the thought.\", min_le/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtPatchIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The textual content of the user's thought.\", min/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"Thought text.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "update_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def update_thought($/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "( thought_id: int = Path(..., description=\"ID of the thought to update.\"), payload: ThoughtPatchIn = ..., x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"The username of the person submitting the thought.\",/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"Username of the author.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtPatchIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_username(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}], "hash": "27c781752855b1ac4f0db54eb3f6a456", "format-version": 4, "code-base-name": "thought_backend", "filename": "thought_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str created_at", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str edit_token", "scope": "ThoughtCreatedResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int id", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str thought_text", "scope": "ThoughtPatchIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}]}