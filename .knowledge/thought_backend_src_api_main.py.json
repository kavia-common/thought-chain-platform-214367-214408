{"is_source_file": true, "format": "Python", "description": "This file defines a FastAPI backend for a 'Daily Thought Chain' application. It includes endpoints for health checks, listing thoughts, creating thoughts with daily submission restrictions, updating thoughts identified by an edit_token, and deleting thoughts. It uses SQLite as the database and incorporates schema management, data validation, and token-based authorization per thought. The code also manages database connection logic, schema initialization, and data transformation for API responses.", "external_files": ["../../../../thought-chain-platform-214367-214407/thought_database/db_connection.txt"], "external_methods": ["os.path.abspath", "os.path.dirname", "os.path.join", "os.path.exists", "re.search", "secrets.token_urlsafe", "datetime.utcnow", "datetime.fromisoformat", "datetime.strftime", "datetime.replace", "sqlite3.connect"], "published": ["health_check", "list_thoughts", "create_thought", "update_thought", "delete_thought"], "classes": [{"name": "ThoughtIn", "description": "Pydantic model for incoming thought submissions, validating username, thought_text, and token."}, {"name": "ThoughtOut", "description": "Pydantic model for representing thoughts in responses, including id, username, thought_text, and created_at."}, {"name": "ThoughtCreatedResponse", "description": "Extended model including edit_token, used after creating a thought."}, {"name": "ThoughtPatchIn", "description": "Model for updating thought_text in existing thoughts."}], "methods": [{"name": "ThoughtOut _row_to_thought_out(row: sqlite3.Row)", "description": "Converts a SQLite row into a ThoughtOut model instance, normalizing the created_at timestamp.", "scope": "", "scopeKind": ""}, {"name": "str _day_key_utc_now()", "description": "Returns current UTC date as a string in YYYY-MM-DD format for daily grouping.", "scope": "", "scopeKind": ""}, {"name": "str _read_sqlite_path_from_db_container()", "description": "Reads and parses the SQLite database file path from a configuration file.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection _get_db_connection()", "description": "Establishes and returns a SQLite database connection with row factory set.", "scope": "", "scopeKind": ""}, {"name": "bool _column_exists(conn: sqlite3.Connection, table: str, column: str)", "description": "Checks whether a specific column exists in a given table.", "scope": "", "scopeKind": ""}, {"name": "bool _index_exists(conn: sqlite3.Connection, index_name: str)", "description": "Checks whether a specific index exists in the database.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_schema(conn: sqlite3.Connection)", "description": "Ensures that the database schema and indexes are set up correctly.", "scope": "", "scopeKind": ""}, {"name": "ThoughtCreatedResponse create_thought(payload: ThoughtIn)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "delete_thought( thought_id: int = Path(..., description=\"ID of the thought to delete.\"), x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[ThoughtOut] list_thoughts()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ThoughtOut update_thought( thought_id: int = Path(..., description=\"ID of the thought to update.\"), payload: ThoughtPatchIn = ..., x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str validate_thought_text(cls, v: str)", "scope": "ThoughtPatchIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str validate_token(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str validate_username(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}], "calls": ["os.path.abspath", "os.path.join", "os.path.exists", "re.search", "secrets.token_urlsafe", "datetime.utcnow", "datetime.fromisoformat", "sqlite3.connect", "conn.execute", "conn.fetchall", "conn.commit", "conn.close"], "search-terms": ["FastAPI", "Thoughts", "SQLite", "thought_text", "edit_token", "ThoughtIn", "ThoughtOut", "daily thoughts", "token per day", "thoughts API", "create_thought", "update_thought", "delete_thought", "thoughts list", "Thoughts endpoints"], "state": 2, "file_id": 4, "knowledge_revision": 24, "git_revision": "3e8e3a1b99667b518458c4e66f2bb07e4a656667", "revision_history": [{"9": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"10": "a481ab20a26b099ca185a0effd79b18ea5f21218"}, {"14": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"15": "f30b577a0c112a5e2891229bb1713d1cad65d7c2"}, {"17": "efcba064533a2f6f23e3272356ccc8e0b776efdb"}, {"18": "efcba064533a2f6f23e3272356ccc8e0b776efdb"}, {"24": "3e8e3a1b99667b518458c4e66f2bb07e4a656667"}], "ctags": [{"_type": "tag", "name": "ThoughtCreatedResponse", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtCreatedResponse(ThoughtOut):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtOut", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ThoughtPatchIn", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^class ThoughtPatchIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_column_exists", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _column_exists(conn: sqlite3.Connection, table: str, column: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: sqlite3.Connection, table: str, column: str)"}, {"_type": "tag", "name": "_day_key_utc_now", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _day_key_utc_now() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_ensure_schema", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _ensure_schema(conn: sqlite3.Connection) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_get_db_connection", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _get_db_connection() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_index_exists", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _index_exists(conn: sqlite3.Connection, index_name: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: sqlite3.Connection, index_name: str)"}, {"_type": "tag", "name": "_read_sqlite_path_from_db_container", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _read_sqlite_path_from_db_container() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_row_to_thought_out", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def _row_to_thought_out(row: sqlite3.Row) -> ThoughtOut:$/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "(row: sqlite3.Row)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def create_thought(payload: ThoughtIn) -> ThoughtCreatedResponse:$/", "language": "Python", "typeref": "typename:ThoughtCreatedResponse", "kind": "function", "signature": "(payload: ThoughtIn)"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    created_at: str = Field(..., description=\"Creation timestamp in ISO 8601 UTC.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "delete_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def delete_thought($/", "language": "Python", "kind": "function", "signature": "( thought_id: int = Path(..., description=\"ID of the thought to delete.\"), x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )"}, {"_type": "tag", "name": "edit_token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    edit_token: str = Field(..., description=\"Secret token required to edit or delete this thoug/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtCreatedResponse", "scopeKind": "class"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    id: int = Field(..., description=\"Unique identifier of the thought.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "list_thoughts", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def list_thoughts() -> List[ThoughtOut]:$/", "language": "Python", "typeref": "typename:List[ThoughtOut]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The new textual content of the thought.\", min_le/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtPatchIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"The textual content of the user's thought.\", min/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    thought_text: str = Field(..., description=\"Thought text.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    token: str = Field(..., description=\"Anonymous client token to enforce 1 submission per UTC /", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "update_thought", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^def update_thought($/", "language": "Python", "typeref": "typename:ThoughtOut", "kind": "function", "signature": "( thought_id: int = Path(..., description=\"ID of the thought to update.\"), payload: ThoughtPatchIn = ..., x_edit_token: Optional[str] = Header(None, alias=\"X-Edit-Token\"), token: Optional[str] = Query(None, description=\"Edit token (alternative to header).\"), )"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"The username of the person submitting the thought.\",/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., description=\"Username of the author.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ThoughtOut", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_thought_text", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_thought_text(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtPatchIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_token", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_token(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}, {"_type": "tag", "name": "validate_username", "path": "/home/kavia/workspace/code-generation/thought-chain-platform-214367-214408/thought_backend/src/api/main.py", "pattern": "/^    def validate_username(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "ThoughtIn", "scopeKind": "class"}], "hash": "cd2515964dab213ba1060a3b5bc020ec", "format-version": 4, "code-base-name": "thought_backend", "filename": "thought_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str created_at", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str edit_token", "scope": "ThoughtCreatedResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int id", "scope": "ThoughtOut", "scopeKind": "class", "description": "unavailable"}, {"name": "str thought_text", "scope": "ThoughtPatchIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str token", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "ThoughtIn", "scopeKind": "class", "description": "unavailable"}]}